\hypertarget{viewpc_8cpp_source}{}\section{viewpc.\+cpp}
\label{viewpc_8cpp_source}\index{C\+:/\+Users/salex/\+Documents/\+Git\+Hub/\+Picture\+Crypt/src/viewpc.\+cpp@{C\+:/\+Users/salex/\+Documents/\+Git\+Hub/\+Picture\+Crypt/src/viewpc.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\mbox{\hyperlink{viewpc_8h}{viewpc.h}}"}
00002 \textcolor{preprocessor}{#include "ui\_viewpc.h"}
00003 
\Hypertarget{viewpc_8cpp_source_l00004}\mbox{\hyperlink{class_view_p_c_a33c96c61f61042319c66c19059836b7f}{00004}} \mbox{\hyperlink{class_view_p_c_a33c96c61f61042319c66c19059836b7f}{ViewPC::ViewPC}}(QWidget *parent) :
00005     QMainWindow(parent),
00006     ui(new \mbox{\hyperlink{namespace_ui}{Ui}}::\mbox{\hyperlink{class_view_p_c}{ViewPC}})
00007 \{
00008     ui->setupUi(\textcolor{keyword}{this});
00009 
00010     \mbox{\hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed}} = \textcolor{keyword}{true};
00011 
00012     \textcolor{comment}{// Alerts dictionary setup}
00013     QFile file(\textcolor{stringliteral}{":/config/ErrorsDict.json"});
00014     \textcolor{keywordflow}{if}(!file.open(QFile::ReadOnly | QFile::Text)) \{
00015         \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}}(\textcolor{stringliteral}{"Cannot open config file!"});
00016         \textcolor{keywordflow}{return};
00017     \}
00018     QByteArray readData = file.readAll();
00019     file.close();
00020 
00021     QJsonParseError error;
00022     QJsonDocument doc = QJsonDocument::fromJson(readData, &error);
00023     \mbox{\hyperlink{class_view_p_c_a26f90436aca32e5bad46f5e69a7e7e09}{errorsDict}} = doc.object();
00024 \}
00025 
\Hypertarget{viewpc_8cpp_source_l00026}\mbox{\hyperlink{class_view_p_c_a91c51f5c1e6ed5ab12b410339f469b0f}{00026}} \mbox{\hyperlink{class_view_p_c_a91c51f5c1e6ed5ab12b410339f469b0f}{ViewPC::~ViewPC}}()
00027 \{
00028     \textcolor{keyword}{delete} ui;
00029 \}
00030 
00031 \textcolor{keywordtype}{void} ViewPC::on\_encryptMode\_clicked()
00032 \{
00033     \textcolor{comment}{// Encrypt radio button clicked}
00034     \mbox{\hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{setEncryptMode}}(\textcolor{keyword}{true});
00035 \}
00036 
00037 \textcolor{keywordtype}{void} ViewPC::on\_decryptMode\_clicked()
00038 \{
00039     \textcolor{comment}{// Decrypt radio button clicked}
00040     \mbox{\hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{setEncryptMode}}(\textcolor{keyword}{false});
00041 \}
\Hypertarget{viewpc_8cpp_source_l00045}\mbox{\hyperlink{class_view_p_c_a3b9b7a7be9702d8b160f257f1c74a776}{00045}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_a3b9b7a7be9702d8b160f257f1c74a776}{ViewPC::on\_fileButton\_clicked}}()
00046 \{
00047     \textcolor{comment}{// Opening QFileDialog depending on isEncrypt}
00048     \textcolor{keywordflow}{if}(isEncrypt)
00049         inputFileName = QFileDialog::getOpenFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Select file"}), \textcolor{stringliteral}{"/untitled.txt"}, tr(\textcolor{stringliteral}{"Text
       files (*.txt);;All Files (*)"}));
00050     \textcolor{keywordflow}{else}
00051         inputFileName = QFileDialog::getOpenFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Select file"}), \textcolor{stringliteral}{"/untitled.png"}, tr(\textcolor{stringliteral}{"PNG
       files (*.png);;All Files (*)"}));
00052     \textcolor{comment}{// Display the file name}
00053     ui->fileLabel->setText(inputFileName.isEmpty() ? \textcolor{stringliteral}{"File not chosen"} : inputFileName);
00054 \}
\Hypertarget{viewpc_8cpp_source_l00067}\mbox{\hyperlink{class_view_p_c_a456d75b7c5d3a089302a576e7359f1f4}{00067}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_a456d75b7c5d3a089302a576e7359f1f4}{ViewPC::on\_startButton\_clicked}}()
00068 \{
00069     \textcolor{keywordflow}{if}(isEncrypt)
00070     \{
00071         \textcolor{comment}{// Getting the data}
00072         QString text = ui->text->toPlainText();
00073         QByteArray \mbox{\hyperlink{namespace_errors_dict_setup_af570460846fb9f0c91abd308a095dcdc}{data}};
00074         \textcolor{keywordflow}{if}(text.isEmpty()) \{
00075             \textcolor{keywordflow}{if}(inputFileName.isEmpty()) \{
00076                 \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}}(\textcolor{stringliteral}{"No input file or text was not given. Cannot continue!"}, \textcolor{keyword}{true});
00077                 \textcolor{keywordflow}{return};
00078             \}
00079             \textcolor{comment}{// Opening the file}
00080             QFile file(inputFileName);
00081             \textcolor{keywordflow}{if} (!file.open(QIODevice::ReadOnly))
00082             \{
00083                 \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}}(\textcolor{stringliteral}{"Cannot open file. Cannot continue!"}, \textcolor{keyword}{true});
00084                 \textcolor{keywordflow}{return};
00085             \}
00086             \textcolor{comment}{// Check the data size}
00087             \textcolor{keyword}{auto} size = file.size();
00088             \textcolor{keywordflow}{if}(size > pow(2, 24)) \{
00089                 \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}}(\textcolor{stringliteral}{"Your file is too big, our systems can handle it, but it requires a lot of time.
       We decline."}, \textcolor{keyword}{true});
00090                 file.close();
00091                 \textcolor{keywordflow}{return};
00092             \}
00093             \mbox{\hyperlink{namespace_errors_dict_setup_af570460846fb9f0c91abd308a095dcdc}{data}} = file.readAll();
00094             file.close();
00095         \}
00096         \textcolor{keywordflow}{else}
00097             \mbox{\hyperlink{namespace_errors_dict_setup_af570460846fb9f0c91abd308a095dcdc}{data}} = text.toUtf8();
00098         \textcolor{comment}{// Select image via EncryptDialog}
00099         \mbox{\hyperlink{class_encrypt_dialog}{EncryptDialog}} * \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}} = \textcolor{keyword}{new} \mbox{\hyperlink{class_encrypt_dialog}{EncryptDialog}}(
      \mbox{\hyperlink{namespace_errors_dict_setup_af570460846fb9f0c91abd308a095dcdc}{data}});
00100         \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->exec();
00101         \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->success)
00102             \textcolor{keywordflow}{return};
00103 
00104         \textcolor{comment}{// Get the data}
00105         QByteArray encr\_data = \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->compr\_data;
00106 
00107         \textcolor{comment}{// Save the key}
00108         QByteArray key\_data = \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->key.toUtf8();
00109 
00110         encr\_data = bytes(key\_data.size()) + key\_data + encr\_data;
00111         \textcolor{comment}{// TODO do the mode thing}
00112         emit \mbox{\hyperlink{class_view_p_c_a2ccc0a3f2f48080ae6308e800646fcd5}{setBitsUsed}}(\mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->bitsUsed);
00113         emit \mbox{\hyperlink{class_view_p_c_ade35449b95cf1c5424c4eb929f46fd73}{encrypt}}(encr\_data, &\mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->image, 0);
00114     \}
00115     \textcolor{keywordflow}{else}
00116     \{
00117         \textcolor{comment}{// Get the filename of the image}
00118         \textcolor{keywordflow}{if}(!ui->text->toPlainText().isEmpty())
00119             \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}}(\textcolor{stringliteral}{"Obviously, the text browser isn't supported for decryption, use File Dialog
       instead."});
00120         \textcolor{keywordflow}{if}(inputFileName.isEmpty()) \{
00121             \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}}(\textcolor{stringliteral}{"File not selected. Cannot continue!"}, \textcolor{keyword}{true});
00122             \textcolor{keywordflow}{return};
00123         \}
00124         QImage * res\_image = \textcolor{keyword}{new} QImage(inputFileName);
00125         emit \mbox{\hyperlink{class_view_p_c_acf8feb98f757cc238dada1df2308e303}{decrypt}}(res\_image);
00126     \}
00127 \}
\Hypertarget{viewpc_8cpp_source_l00133}\mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{00133}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{ViewPC::alert}}(QString message, \textcolor{keywordtype}{bool} isWarning)
00134 \{
00135     \textcolor{comment}{// Get message}
00136     \textcolor{keywordflow}{if}(\mbox{\hyperlink{class_view_p_c_a26f90436aca32e5bad46f5e69a7e7e09}{errorsDict}}.contains(message))
00137         message = \mbox{\hyperlink{class_view_p_c_a26f90436aca32e5bad46f5e69a7e7e09}{errorsDict}}[message].toString();
00138     \textcolor{comment}{// Create message box}
00139     QMessageBox box;
00140     \textcolor{keywordflow}{if}(isWarning)
00141         box.setIcon(QMessageBox::Warning);
00142     \textcolor{keywordflow}{else}
00143         box.setIcon(QMessageBox::Information);
00144     box.setText(message);
00145     box.setWindowIcon(QIcon(\textcolor{stringliteral}{":/icons/mail.png"}));
00146     box.setWindowTitle(\textcolor{stringliteral}{"Message"});
00147     box.exec();
00148 \}
\Hypertarget{viewpc_8cpp_source_l00154}\mbox{\hyperlink{class_view_p_c_aaff156103970be7c777beedaf0020604}{00154}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_aaff156103970be7c777beedaf0020604}{ViewPC::saveData}}(QByteArray Edata)
00155 \{
00156     \textcolor{comment}{// Save data using QFileDialog}
00157     QString outputFileName = QFileDialog::getSaveFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Save File"}),
00158                                \textcolor{stringliteral}{"/untitled.txt"},
00159                                tr(\textcolor{stringliteral}{"Text(*.txt);;All files (*)"}));
00160     QFile writeFile(outputFileName);
00161     \textcolor{keywordflow}{if} (!writeFile.open(QIODevice::WriteOnly))
00162     \{
00163         \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}}(\textcolor{stringliteral}{"Cannot access file path. Cannot continue!"}, \textcolor{keyword}{true});
00164         \textcolor{keywordflow}{return};
00165     \}
00166     writeFile.write(Edata);
00167     writeFile.close();
00168     \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}}(\textcolor{stringliteral}{"Decryption completed!"});
00169 \}
\Hypertarget{viewpc_8cpp_source_l00175}\mbox{\hyperlink{class_view_p_c_a7901ce10ffaaf2387bef1db7feea342d}{00175}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_a7901ce10ffaaf2387bef1db7feea342d}{ViewPC::saveImage}}(QImage * \mbox{\hyperlink{namespacetests-setup_ad55b685280f549e15688a94cbb89f512}{image}})
00176 \{
00177     \textcolor{comment}{// Save image using QFileDialog}
00178     QString outputFileName = QFileDialog::getSaveFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Save Image"}),
00179                                \textcolor{stringliteral}{"/untitled.png"},
00180                                tr(\textcolor{stringliteral}{"Images(*.png)"}));
00181     \textcolor{keywordflow}{if}(!\mbox{\hyperlink{namespacetests-setup_ad55b685280f549e15688a94cbb89f512}{image}}->save(outputFileName)) \{
00182         \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}}(\textcolor{stringliteral}{"Cannot save file. Unable to continue!"}, \textcolor{keyword}{true});
00183         \textcolor{keywordflow}{return};
00184     \}
00185     \mbox{\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}}(\textcolor{stringliteral}{"Encryption completed!"});
00186 \}
\Hypertarget{viewpc_8cpp_source_l00193}\mbox{\hyperlink{class_view_p_c_a9c32a1fdb6ead84e5ada8fba8860c7ed}{00193}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_a9c32a1fdb6ead84e5ada8fba8860c7ed}{ViewPC::setProgress}}(\textcolor{keywordtype}{int} val)
00194 \{
00195     \textcolor{keywordflow}{if}(val < 0) \{
00196         \textcolor{comment}{// Create dialog}
00197         \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}} = \textcolor{keyword}{new} QProgressDialog(\textcolor{stringliteral}{"Cryption in progress."}, \textcolor{stringliteral}{"Cancel"}, 0, 100);
00198         connect(\mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}, SIGNAL(canceled()), \textcolor{keyword}{this}, SLOT(\mbox{\hyperlink{class_view_p_c_ad7ba2fcf1d17862de15e32432823f7b0}{abortCircuit}}()));
00199         \mbox{\hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed}} = \textcolor{keyword}{false};
00200         \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->setWindowTitle(\textcolor{stringliteral}{"Processing"});
00201         \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->setWindowIcon(QIcon(\textcolor{stringliteral}{":/icons/loading.png"}));
00202         \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->show();
00203     \}
00204     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(val >= 100 && !\mbox{\hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed}}) \{
00205         \textcolor{comment}{// Close dialog}
00206         \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->setValue(100);
00207         QThread::msleep(25);
00208         \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->close();
00209         \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->reset();
00210         \mbox{\hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed}} = \textcolor{keyword}{true};
00211     \}
00212     \textcolor{comment}{// Update the progress}
00213     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed}})
00214         \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->setValue(val);
00215 \}
\Hypertarget{viewpc_8cpp_source_l00219}\mbox{\hyperlink{class_view_p_c_ad7ba2fcf1d17862de15e32432823f7b0}{00219}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_ad7ba2fcf1d17862de15e32432823f7b0}{ViewPC::abortCircuit}}()
00220 \{
00221     \textcolor{comment}{// Set the flag}
00222     \mbox{\hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed}} = \textcolor{keyword}{true};
00223     \textcolor{comment}{// Close the dialog}
00224     \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->close();
00225     \mbox{\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}}->reset();
00226     emit \mbox{\hyperlink{class_view_p_c_a863f5233af3791bd165a2811a5d9bcc2}{abortModel}}();
00227 \}
\Hypertarget{viewpc_8cpp_source_l00232}\mbox{\hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{00232}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{ViewPC::setEncryptMode}}(\textcolor{keywordtype}{bool} encr)
00233 \{
00234     ui->text->setEnabled(encr);
00235     isEncrypt = encr;
00236 \}
\Hypertarget{viewpc_8cpp_source_l00241}\mbox{\hyperlink{class_view_p_c_ac05220df875b7c4f24405a5742476ebf}{00241}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_ac05220df875b7c4f24405a5742476ebf}{ViewPC::setVersion}}(QString version)
00242 \{
00243     \textcolor{comment}{// Version setup}
00244     versionString = version;
00245 \}
00246 
00247 QByteArray ViewPC::bytes(\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} n)
00248 \{
00249     \textcolor{keywordflow}{return} QByteArray::fromHex(QByteArray::number(n, 16));
00250 \}
\Hypertarget{viewpc_8cpp_source_l00254}\mbox{\hyperlink{class_view_p_c_a09a46da4d492eb3dde88f35dc58c997b}{00254}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_a09a46da4d492eb3dde88f35dc58c997b}{ViewPC::on\_actionAbout\_triggered}}()
00255 \{
00256     \mbox{\hyperlink{class_about_p_c}{AboutPC}} about;
00257     about.\mbox{\hyperlink{class_about_p_c_aa3815d4826d0c8d87122449537a0a4d5}{setVersion}}(versionString);
00258     about.exec();
00259 \}
00260 
\Hypertarget{viewpc_8cpp_source_l00264}\mbox{\hyperlink{class_view_p_c_a0d252ff4829260c6c76769fbd24b7cd7}{00264}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_view_p_c_a0d252ff4829260c6c76769fbd24b7cd7}{ViewPC::on\_actionHelp\_triggered}}()
00265 \{
00266     QUrl docLink(\textcolor{stringliteral}{"http://doc.alex.unaux.com/picturecrypt"});
00267     QDesktopServices::openUrl(docLink);
00268 \}
00269 
00270 \textcolor{keywordtype}{void} ViewPC::on\_actionJPHS\_path\_triggered()
00271 \{
00272     QString dir = QFileDialog::getExistingDirectory(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Open JPHS folder"}),
00273                                                     \textcolor{stringliteral}{"/home"},
00274                                                     QFileDialog::ShowDirsOnly
00275                                                     | QFileDialog::DontResolveSymlinks);
00276     emit \mbox{\hyperlink{class_view_p_c_ababceedc355ecc1217a4c708e19e5e6b}{setJPHSDir}}(dir);
00277 \}
\end{DoxyCode}
