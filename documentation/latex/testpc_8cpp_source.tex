\hypertarget{testpc_8cpp_source}{}\section{testpc.\+cpp}
\label{testpc_8cpp_source}\index{C\+:/\+Users/salex/\+Documents/\+Git\+Hub/\+Picture\+Crypt/src/unit\+\_\+tests/testpc.\+cpp@{C\+:/\+Users/salex/\+Documents/\+Git\+Hub/\+Picture\+Crypt/src/unit\+\_\+tests/testpc.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\mbox{\hyperlink{testpc_8h}{testpc.h}}"}
\Hypertarget{testpc_8cpp_source_l00005}\mbox{\hyperlink{class_test_p_c_a65226eb54f1ff76639c9fb1e2013e430}{00005}} \mbox{\hyperlink{class_test_p_c_a65226eb54f1ff76639c9fb1e2013e430}{TestPC::TestPC}}()
00006 \{ \}
\Hypertarget{testpc_8cpp_source_l00018}\mbox{\hyperlink{class_test_p_c_a612a0409006417c6f03e1749bca0d45a}{00018}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_test_p_c_a612a0409006417c6f03e1749bca0d45a}{TestPC::test}}(QByteArray \mbox{\hyperlink{namespace_errors_dict_setup_af570460846fb9f0c91abd308a095dcdc}{data}}, QImage rImage, QString expectedOutput, \textcolor{keywordtype}{int} 
      \mbox{\hyperlink{namespacetests-setup_a04126d10edec6b3171e1b55a00309b23}{mode}}, QString \mbox{\hyperlink{namespace_errors_dict_setup_a09c268098d09ffb8e5504f30fa6d5dd9}{key}}, \textcolor{keywordtype}{int} \mbox{\hyperlink{namespacetests-setup_a64974eb034f518d24195739395783d3d}{bitsUsed}})
00019 \{
00020     \textcolor{comment}{// Error outputs}
00021     QString error1, error2;
00022     \textcolor{comment}{// Embedding}
00023     QImage * retImage = model->\mbox{\hyperlink{class_model_p_c_a3cae34fd5bcb06e8c1f8cfe7961bd270}{start}}(\mbox{\hyperlink{namespace_errors_dict_setup_af570460846fb9f0c91abd308a095dcdc}{data}}, &rImage, \mbox{\hyperlink{namespacetests-setup_a04126d10edec6b3171e1b55a00309b23}{mode}}, \mbox{\hyperlink{namespace_errors_dict_setup_a09c268098d09ffb8e5504f30fa6d5dd9}{key}}, 
      \mbox{\hyperlink{namespacetests-setup_a64974eb034f518d24195739395783d3d}{bitsUsed}}, &error1);
00024     \textcolor{comment}{// De-embedding}
00025     QByteArray output = model->\mbox{\hyperlink{class_model_p_c_af1f0b21565bf39808c4cdd448fad0ea8}{decrypt}}(retImage, &error2);
00026 
00027     \textcolor{comment}{// Success of error outputs}
00028     \textcolor{keywordtype}{bool} er1 = error1 == expectedOutput;
00029     \textcolor{keywordtype}{bool} er2 = error2 == expectedOutput;
00030     \textcolor{keywordflow}{if}(expectedOutput == \textcolor{stringliteral}{"ok"})
00031         \textcolor{keywordflow}{return} er1 && er2 && \mbox{\hyperlink{namespace_errors_dict_setup_af570460846fb9f0c91abd308a095dcdc}{data}} == output;
00032     \textcolor{keywordflow}{else}
00033         \textcolor{keywordflow}{return} er1 || er2;
00034 \}
\Hypertarget{testpc_8cpp_source_l00042}\mbox{\hyperlink{class_test_p_c_ad0d724439a65d183d3d336b667cb867b}{00042}} \textcolor{keywordtype}{int} \mbox{\hyperlink{class_test_p_c_ad0d724439a65d183d3d336b667cb867b}{TestPC::startTest}}()
00043 \{
00044     qDebug() << \textcolor{stringliteral}{"Testing started...\(\backslash\)n"};
00045     model = \textcolor{keyword}{new} \mbox{\hyperlink{class_model_p_c}{ModelPC}}();
00046 
00047     \textcolor{comment}{// Long text open}
00048     QFile file(\textcolor{stringliteral}{":/unit\_tests/longtext.txt"});
00049     \textcolor{keywordflow}{if}(!file.open(QFile::ReadOnly))
00050         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00051     text = file.readAll();
00052     file.close();
00053 
00054     \textcolor{comment}{// Big picture open}
00055     image = QImage(\textcolor{stringliteral}{":/unit\_tests/bigpicture.jpg"});
00056     \textcolor{keywordflow}{if}(image.isNull())
00057         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00058 
00059     \textcolor{comment}{// JSON tests list open}
00060     QFile json\_file(\textcolor{stringliteral}{":/unit\_tests/tests.json"});
00061     QJsonDocument doc;
00062     \textcolor{keywordflow}{if}(!json\_file.open(QFile::ReadOnly | QFile::Text))
00063         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00064     QByteArray readData = json\_file.readAll();
00065     json\_file.close();
00066     doc = QJsonDocument::fromJson(readData);
00067     \textcolor{comment}{// Testing}
00068     \textcolor{keywordflow}{return} autoTest(doc);
00069 \}
00077 \textcolor{keywordtype}{bool} TestPC::autoTest(QJsonDocument doc)
00078 \{
00079     \textcolor{comment}{// Opening the tests array}
00080     QJsonObject o = doc.object();
00081     QJsonArray \mbox{\hyperlink{namespacetests-setup_a274aaa7c0d5733ef5f48372d9481f34a}{arr}} = o[\textcolor{stringliteral}{"tests"}].toArray();
00082     \textcolor{keywordtype}{int} sum = 0;
00083 
00084     \textcolor{comment}{// Info about tests}
00085     QString extraText;
00086     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < \mbox{\hyperlink{namespacetests-setup_a274aaa7c0d5733ef5f48372d9481f34a}{arr}}.size(); i++) \{
00087         \textcolor{comment}{// Reading the data}
00088         QJsonObject \mbox{\hyperlink{namespacetests-setup_afb80c1236926b5468a6d3e942a527a96}{obj}} = \mbox{\hyperlink{namespacetests-setup_a274aaa7c0d5733ef5f48372d9481f34a}{arr}}[i].toObject();
00089 
00090         QString t = \mbox{\hyperlink{namespacetests-setup_afb80c1236926b5468a6d3e942a527a96}{obj}}[\textcolor{stringliteral}{"data"}].toString();
00091         \textcolor{keywordflow}{if}(t == \textcolor{stringliteral}{"/text/"})
00092             t = text;
00093         QByteArray \mbox{\hyperlink{namespace_errors_dict_setup_af570460846fb9f0c91abd308a095dcdc}{data}} = t.toUtf8();
00094 
00095         QString im = \mbox{\hyperlink{namespacetests-setup_afb80c1236926b5468a6d3e942a527a96}{obj}}[\textcolor{stringliteral}{"image"}].toString();
00096         QImage img(\textcolor{stringliteral}{":/unit\_tests/"} + im);
00097 
00098         QString \mbox{\hyperlink{namespacetests-setup_a2c17344dec99b9aaaddaef4438b1f793}{expect}} = \mbox{\hyperlink{namespacetests-setup_afb80c1236926b5468a6d3e942a527a96}{obj}}[\textcolor{stringliteral}{"expectation"}].toString();
00099 
00100         \textcolor{keywordtype}{int} \mbox{\hyperlink{namespacetests-setup_a04126d10edec6b3171e1b55a00309b23}{mode}} = \mbox{\hyperlink{namespacetests-setup_afb80c1236926b5468a6d3e942a527a96}{obj}}[\textcolor{stringliteral}{"mode"}].toInt();
00101 
00102         QString \mbox{\hyperlink{namespace_errors_dict_setup_a09c268098d09ffb8e5504f30fa6d5dd9}{key}} = \mbox{\hyperlink{namespacetests-setup_afb80c1236926b5468a6d3e942a527a96}{obj}}[\textcolor{stringliteral}{"key"}].toString();
00103 
00104         \textcolor{keywordtype}{int} \mbox{\hyperlink{namespacetests-setup_a64974eb034f518d24195739395783d3d}{bitsUsed}} = \mbox{\hyperlink{namespacetests-setup_afb80c1236926b5468a6d3e942a527a96}{obj}}[\textcolor{stringliteral}{"bitsUsed"}].toInt();
00105 
00106         \textcolor{comment}{// Testing}
00107         \textcolor{keywordtype}{bool} s = \mbox{\hyperlink{class_test_p_c_a612a0409006417c6f03e1749bca0d45a}{test}}(\mbox{\hyperlink{namespace_errors_dict_setup_af570460846fb9f0c91abd308a095dcdc}{data}}, img, \mbox{\hyperlink{namespacetests-setup_a2c17344dec99b9aaaddaef4438b1f793}{expect}}, \mbox{\hyperlink{namespacetests-setup_a04126d10edec6b3171e1b55a00309b23}{mode}}, \mbox{\hyperlink{namespace_errors_dict_setup_a09c268098d09ffb8e5504f30fa6d5dd9}{key}}, 
      \mbox{\hyperlink{namespacetests-setup_a64974eb034f518d24195739395783d3d}{bitsUsed}});
00108 
00109         sum += s;
00110         extraText += \textcolor{stringliteral}{"\(\backslash\)n * Test #"} + QString::number(i + 1) + \textcolor{stringliteral}{" "} + (s ? \textcolor{stringliteral}{"completed."} : \textcolor{stringliteral}{"failed."});
00111     \}
00112     \textcolor{comment}{// Writing log}
00113     QFile file(\textcolor{stringliteral}{"tests.log"});
00114     \textcolor{keywordtype}{bool} testsSuc = sum == \mbox{\hyperlink{namespacetests-setup_a274aaa7c0d5733ef5f48372d9481f34a}{arr}}.size();
00115     \textcolor{keywordflow}{if}(!file.open(QFile::WriteOnly | QFile::Text))
00116         \textcolor{keywordflow}{return} testsSuc;
00117     QDateTime curTime = QDateTime::currentDateTime();
00118     QString date = curTime.toString(\textcolor{stringliteral}{"dd.MM.yyyy HH:mm"});
00119     QString logtext = \textcolor{stringliteral}{"############################################\(\backslash\)n"}
00120                       \textcolor{stringliteral}{"####Log file created at "} + date + \textcolor{stringliteral}{"####\(\backslash\)n"}
00121                       \textcolor{stringliteral}{"############################################\(\backslash\)n\(\backslash\)n"}
00122                       \textcolor{stringliteral}{"Status: "} + (testsSuc ? \textcolor{stringliteral}{"All tests completed"} : \textcolor{stringliteral}{"Tests failed"}) + \textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)n"}
00123                       \textcolor{stringliteral}{"Tests list:\(\backslash\)n"};
00124     logtext += extraText;
00125     file.write(logtext.toUtf8());
00126     file.close();
00127     \textcolor{comment}{// Cleaning up}
00128     qDebug() << \textcolor{stringliteral}{"Testing completed\(\backslash\)n"};
00129     \textcolor{keyword}{delete} model;
00130     \textcolor{keywordflow}{return} testsSuc;
00131 \}
\end{DoxyCode}
