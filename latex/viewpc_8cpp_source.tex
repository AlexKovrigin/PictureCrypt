\hypertarget{viewpc_8cpp_source}{\section{viewpc.\-cpp}
}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\hyperlink{viewpc_8h}{viewpc.h}"}
00002 \textcolor{preprocessor}{#include "ui\_viewpc.h"}
00003 
\hypertarget{viewpc_8cpp_source_l00004}{}\hyperlink{class_view_p_c_a33c96c61f61042319c66c19059836b7f}{00004} \hyperlink{class_view_p_c_a33c96c61f61042319c66c19059836b7f}{ViewPC::ViewPC}(QWidget *parent) :
00005     QMainWindow(parent),
00006     ui(new Ui::\hyperlink{class_view_p_c}{ViewPC})
00007 \{
00008     ui->setupUi(\textcolor{keyword}{this});
00009 
00010     \hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed} = \textcolor{keyword}{true};
00011 
00012     \textcolor{comment}{// Alerts dictionary setup}
00013     QFile file(\textcolor{stringliteral}{":/config/ErrorsDict.json"});
00014     \textcolor{keywordflow}{if}(!file.open(QFile::ReadOnly | QFile::Text)) \{
00015         \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"Cannot open config file!"});
00016         \textcolor{keywordflow}{return};
00017     \}
00018     QByteArray readData = file.readAll();
00019     file.close();
00020 
00021     QJsonParseError error;
00022     QJsonDocument doc = QJsonDocument::fromJson(readData, &error);
00023     \hyperlink{class_view_p_c_a26f90436aca32e5bad46f5e69a7e7e09}{errorsDict} = doc.object();
00024 \}
\hypertarget{viewpc_8cpp_source_l00028}{}\hyperlink{class_view_p_c_a91c51f5c1e6ed5ab12b410339f469b0f}{00028} \hyperlink{class_view_p_c_a91c51f5c1e6ed5ab12b410339f469b0f}{ViewPC::~ViewPC}()
00029 \{
00030     \textcolor{keyword}{delete} ui;
00031 \}
00032 
00033 \textcolor{keywordtype}{void} ViewPC::on\_encryptMode\_clicked()
00034 \{
00035     \textcolor{comment}{// Encrypt radio button clicked}
00036     \hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{setEncryptMode}(\textcolor{keyword}{true});
00037 \}
00038 
00039 \textcolor{keywordtype}{void} ViewPC::on\_decryptMode\_clicked()
00040 \{
00041     \textcolor{comment}{// Decrypt radio button clicked}
00042     \hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{setEncryptMode}(\textcolor{keyword}{false});
00043 \}
\hypertarget{viewpc_8cpp_source_l00047}{}\hyperlink{class_view_p_c_a3b9b7a7be9702d8b160f257f1c74a776}{00047} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a3b9b7a7be9702d8b160f257f1c74a776}{ViewPC::on\_fileButton\_clicked}()
00048 \{
00049     \textcolor{comment}{// Opening QFileDialog depending on isEncrypt}
00050     \textcolor{keywordflow}{if}(isEncrypt)
00051         inputFileName = QFileDialog::getOpenFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Select file"}), \textcolor{stringliteral}{"/untitled.txt"}, tr(\textcolor{stringliteral}{"Text
       files (*.txt);;All Files (*)"}));
00052     \textcolor{keywordflow}{else}
00053         inputFileName = QFileDialog::getOpenFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Select file"}), \textcolor{stringliteral}{"/untitled.png"}, tr(\textcolor{stringliteral}{"PNG
       files (*.png);;All Files (*)"}));
00054     \textcolor{comment}{// Display the file name}
00055     ui->fileLabel->setText(inputFileName.isEmpty() ? \textcolor{stringliteral}{"File not chosen"} : inputFileName);
00056 \}
\hypertarget{viewpc_8cpp_source_l00069}{}\hyperlink{class_view_p_c_a456d75b7c5d3a089302a576e7359f1f4}{00069} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a456d75b7c5d3a089302a576e7359f1f4}{ViewPC::on\_startButton\_clicked}()
00070 \{
00071     \textcolor{keywordflow}{if}(isEncrypt)
00072     \{
00073         \textcolor{comment}{// Getting the data}
00074         QString text = ui->text->toPlainText();
00075         QByteArray \hyperlink{namespace_errors_dict_setup_adf4c30d205d29df7343e26f7c62b0685}{data};
00076         \textcolor{keywordflow}{if}(text.isEmpty()) \{
00077             \textcolor{keywordflow}{if}(inputFileName.isEmpty()) \{
00078                 \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"No input file or text was not given. Cannot continue!"}, \textcolor{keyword}{true});
00079                 \textcolor{keywordflow}{return};
00080             \}
00081             \textcolor{comment}{// Opening the file}
00082             QFile file(inputFileName);
00083             \textcolor{keywordflow}{if} (!file.open(QIODevice::ReadOnly))
00084             \{
00085                 \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"Cannot open file. Cannot continue!"}, \textcolor{keyword}{true});
00086                 \textcolor{keywordflow}{return};
00087             \}
00088             \textcolor{comment}{// Check the data size}
00089             \textcolor{keyword}{auto} size = file.size();
00090             \textcolor{keywordflow}{if}(size > qPow(2, 24)) \{
00091                 \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"Your file is too big, our systems can handle it, but it requires a lot of time.
       We decline."}, \textcolor{keyword}{true});
00092                 file.close();
00093                 \textcolor{keywordflow}{return};
00094             \}
00095             data = file.readAll();
00096             file.close();
00097         \}
00098         \textcolor{keywordflow}{else}
00099             data = text.toUtf8();
00100         \textcolor{comment}{// Select image via EncryptDialog}
00101         \hyperlink{class_encrypt_dialog}{EncryptDialog} * \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog} = \textcolor{keyword}{new} \hyperlink{class_encrypt_dialog}{EncryptDialog}(data);
00102         dialog->exec();
00103         \textcolor{keywordflow}{if}(!dialog->\hyperlink{class_encrypt_dialog_ada4900bcd40894d9c098c65aa4066ac9}{success})
00104             \textcolor{keywordflow}{return};
00105 
00106         \textcolor{comment}{// Get the data}
00107         QByteArray encr\_data = dialog->\hyperlink{class_encrypt_dialog_a3e8998aa39696cbd1242f6420ef18143}{compr\_data};
00108 
00109         \textcolor{comment}{// Save the hash}
00110         QByteArray hash = QCryptographicHash::hash(data, QCryptographicHash::Sha256);
00111         encr\_data = hash + encr\_data;
00112         \textcolor{comment}{// TODO do the mode thing}
00113         emit \hyperlink{class_view_p_c_a27ecfb84029d42029631b776a02ff5d8}{encrypt}(encr\_data, &dialog->\hyperlink{class_encrypt_dialog_a739a0df1d28d06b28a3fd16e2bc16c73}{image}, 1, dialog->\hyperlink{class_encrypt_dialog_abf638fea37fbdbaba215954e2e239860}{bitsUsed});
00114     \}
00115     \textcolor{keywordflow}{else}
00116     \{
00117         \textcolor{comment}{// Get the filename of the image}
00118         \textcolor{keywordflow}{if}(!ui->text->toPlainText().isEmpty())
00119             \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"Obviously, the text browser isn't supported for decryption, use File Dialog
       instead."});
00120         \textcolor{keywordflow}{if}(inputFileName.isEmpty()) \{
00121             \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"File not selected. Cannot continue!"}, \textcolor{keyword}{true});
00122             \textcolor{keywordflow}{return};
00123         \}
00124         QByteArray key = \hyperlink{class_view_p_c_a559c95675ec98b15451f3bca47033d9c}{requestKey}().toUtf8();
00125         \textcolor{keywordflow}{if}(key.isEmpty())
00126             \textcolor{keywordflow}{return};
00127         QImage * res\_image = \textcolor{keyword}{new} QImage(inputFileName);
00128         emit \hyperlink{class_view_p_c_a365df051360d557c7221474ad856e0af}{decrypt}(res\_image, key, 1);
00129     \}
00130 \}
\hypertarget{viewpc_8cpp_source_l00136}{}\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{00136} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{ViewPC::alert}(QString message, \textcolor{keywordtype}{bool} isWarning)
00137 \{
00138     \textcolor{comment}{// Get message}
00139     \textcolor{keywordflow}{if}(\hyperlink{class_view_p_c_a26f90436aca32e5bad46f5e69a7e7e09}{errorsDict}.contains(message))
00140         message = \hyperlink{class_view_p_c_a26f90436aca32e5bad46f5e69a7e7e09}{errorsDict}[message].toString();
00141     \textcolor{comment}{// Create message box}
00142     QMessageBox box;
00143     \textcolor{keywordflow}{if}(isWarning)
00144         box.setIcon(QMessageBox::Warning);
00145     \textcolor{keywordflow}{else}
00146         box.setIcon(QMessageBox::Information);
00147     box.setText(message);
00148     box.setWindowIcon(QIcon(\textcolor{stringliteral}{":/icons/mail.png"}));
00149     box.setWindowTitle(\textcolor{stringliteral}{"Message"});
00150     box.exec();
00151 \}
\hypertarget{viewpc_8cpp_source_l00157}{}\hyperlink{class_view_p_c_aaff156103970be7c777beedaf0020604}{00157} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_aaff156103970be7c777beedaf0020604}{ViewPC::saveData}(QByteArray Edata)
00158 \{
00159     \textcolor{comment}{// Save data using QFileDialog}
00160     QString outputFileName = QFileDialog::getSaveFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Save File"}),
00161                                \textcolor{stringliteral}{"/untitled.txt"},
00162                                tr(\textcolor{stringliteral}{"Text(*.txt);;All files (*)"}));
00163     QFile writeFile(outputFileName);
00164     \textcolor{keywordflow}{if} (!writeFile.open(QIODevice::WriteOnly))
00165     \{
00166         \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"Cannot access file path. Cannot continue!"}, \textcolor{keyword}{true});
00167         \textcolor{keywordflow}{return};
00168     \}
00169     writeFile.write(Edata);
00170     writeFile.close();
00171     \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"Decryption completed!"});
00172 \}
\hypertarget{viewpc_8cpp_source_l00178}{}\hyperlink{class_view_p_c_a7901ce10ffaaf2387bef1db7feea342d}{00178} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a7901ce10ffaaf2387bef1db7feea342d}{ViewPC::saveImage}(QImage * image)
00179 \{
00180     \textcolor{comment}{// Save image using QFileDialog}
00181     QString outputFileName = QFileDialog::getSaveFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Save Image"}),
00182                                \textcolor{stringliteral}{"/untitled.png"},
00183                                tr(\textcolor{stringliteral}{"Images(*.png)"}));
00184     \textcolor{keywordflow}{if}(!image->save(outputFileName)) \{
00185         \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"Cannot save file. Unable to continue!"}, \textcolor{keyword}{true});
00186         \textcolor{keywordflow}{return};
00187     \}
00188     \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"Encryption completed!"});
00189 \}
\hypertarget{viewpc_8cpp_source_l00196}{}\hyperlink{class_view_p_c_a9c32a1fdb6ead84e5ada8fba8860c7ed}{00196} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a9c32a1fdb6ead84e5ada8fba8860c7ed}{ViewPC::setProgress}(\textcolor{keywordtype}{int} val)
00197 \{
00198     \textcolor{keywordflow}{if}(val < 0) \{
00199         \textcolor{comment}{// Create dialog}
00200         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog} = \textcolor{keyword}{new} QProgressDialog(\textcolor{stringliteral}{"Cryption in progress."}, \textcolor{stringliteral}{"Cancel"}, 0, 100);
00201         connect(\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}, SIGNAL(canceled()), \textcolor{keyword}{this}, SLOT(\hyperlink{class_view_p_c_ad7ba2fcf1d17862de15e32432823f7b0}{abortCircuit}()));
00202         \hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed} = \textcolor{keyword}{false};
00203         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->setWindowTitle(\textcolor{stringliteral}{"Processing"});
00204         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->setWindowIcon(QIcon(\textcolor{stringliteral}{":/icons/loading.png"}));
00205         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->show();
00206     \}
00207     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(val >= 100 && !\hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed}) \{
00208         \textcolor{comment}{// Close dialog}
00209         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->setValue(100);
00210         QThread::msleep(25);
00211         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->close();
00212         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->reset();
00213         \hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed} = \textcolor{keyword}{true};
00214     \}
00215     \textcolor{comment}{// Update the progress}
00216     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed})
00217         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->setValue(val);
00218 \}
\hypertarget{viewpc_8cpp_source_l00222}{}\hyperlink{class_view_p_c_ad7ba2fcf1d17862de15e32432823f7b0}{00222} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_ad7ba2fcf1d17862de15e32432823f7b0}{ViewPC::abortCircuit}()
00223 \{
00224     \textcolor{comment}{// Set the flag}
00225     \hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed} = \textcolor{keyword}{true};
00226     \textcolor{comment}{// Close the dialog}
00227     \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->close();
00228     \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->reset();
00229     emit \hyperlink{class_view_p_c_aa652102ce6b5757b8eef830409c8cabf}{abortModel}();
00230 \}
\hypertarget{viewpc_8cpp_source_l00235}{}\hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{00235} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{ViewPC::setEncryptMode}(\textcolor{keywordtype}{bool} encr)
00236 \{
00237     ui->text->setEnabled(encr);
00238     isEncrypt = encr;
00239     ui->startButton->setText(encr ? \textcolor{stringliteral}{"Continue configuration"} : \textcolor{stringliteral}{"Start decryption"});
00240     ui->enLabel1->setText(encr ? \textcolor{stringliteral}{"Type in the text for encryption:"} : \textcolor{stringliteral}{"Text input isn't supported in
       decryption mode"});
00241     ui->enLabel1->setEnabled(encr);
00242     ui->enLabel2->setText(encr ? \textcolor{stringliteral}{"Or use the file dialog to choose a file:"} : \textcolor{stringliteral}{"Choose a file for
       decryption:"});
00243 \}
\hypertarget{viewpc_8cpp_source_l00248}{}\hyperlink{class_view_p_c_ac05220df875b7c4f24405a5742476ebf}{00248} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_ac05220df875b7c4f24405a5742476ebf}{ViewPC::setVersion}(QString version)
00249 \{
00250     \textcolor{comment}{// Version setup}
00251     versionString = version;
00252 \}
\hypertarget{viewpc_8cpp_source_l00257}{}\hyperlink{class_view_p_c_a559c95675ec98b15451f3bca47033d9c}{00257} QString \hyperlink{class_view_p_c_a559c95675ec98b15451f3bca47033d9c}{ViewPC::requestKey}()
00258 \{
00259     \textcolor{keywordtype}{bool} ok;
00260     QString text = QInputDialog::getText(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"QInputDialog::getText()"}),
00261                                          tr(\textcolor{stringliteral}{"Enter the keyphrase:"}), QLineEdit::Normal,
00262                                          QDir::home().dirName(), &ok);
00263     \textcolor{keywordflow}{if}(text.isEmpty() && ok) \{
00264         \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"Key is empty!"}, \textcolor{keyword}{true});
00265         \textcolor{keywordflow}{return} QString();
00266     \}
00267     \textcolor{keywordflow}{return} ok ? text : QString();
00268 \}
00269 
00270 QByteArray ViewPC::bytes(\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} n)
00271 \{
00272     \textcolor{keywordflow}{return} QByteArray::fromHex(QByteArray::number(n, 16));
00273 \}
\hypertarget{viewpc_8cpp_source_l00277}{}\hyperlink{class_view_p_c_a09a46da4d492eb3dde88f35dc58c997b}{00277} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a09a46da4d492eb3dde88f35dc58c997b}{ViewPC::on\_actionAbout\_triggered}()
00278 \{
00279     \hyperlink{class_about_p_c}{AboutPC} about;
00280     about.\hyperlink{class_about_p_c_aa3815d4826d0c8d87122449537a0a4d5}{setVersion}(versionString);
00281     about.exec();
00282 \}
00283 
\hypertarget{viewpc_8cpp_source_l00287}{}\hyperlink{class_view_p_c_a0d252ff4829260c6c76769fbd24b7cd7}{00287} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a0d252ff4829260c6c76769fbd24b7cd7}{ViewPC::on\_actionHelp\_triggered}()
00288 \{
00289     QUrl docLink(\textcolor{stringliteral}{"https://alexkovrigin.me/PictureCrypt"});
00290     QDesktopServices::openUrl(docLink);
00291 \}
00292 
00293 \textcolor{keywordtype}{void} ViewPC::on\_actionJPHS\_path\_triggered()
00294 \{
00295     QString dir = QFileDialog::getExistingDirectory(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Open JPHS folder"}),
00296                                                     \textcolor{stringliteral}{"/home"},
00297                                                     QFileDialog::ShowDirsOnly
00298                                                     | QFileDialog::DontResolveSymlinks);
00299     emit \hyperlink{class_view_p_c_ae81085836c0c01bc9556a5b27eb8d19c}{setJPHSDir}(dir);
00300 \}
00301 
00302 \textcolor{keywordtype}{void} ViewPC::on\_actionRun\_tests\_triggered()
00303 \{
00304     emit \hyperlink{class_view_p_c_a96a6c95728bf20c64d2a8fe978495395}{runTests}();
00305 \}
\end{DoxyCode}
