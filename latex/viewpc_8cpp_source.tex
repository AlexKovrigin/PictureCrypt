\hypertarget{viewpc_8cpp_source}{}\section{viewpc.\+cpp}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\hyperlink{viewpc_8h}{viewpc.h}"}
00002 \textcolor{preprocessor}{#include "ui\_viewpc.h"}
00003 
\hypertarget{viewpc_8cpp_source.tex_l00004}{}\hyperlink{class_view_p_c_a33c96c61f61042319c66c19059836b7f}{00004} \hyperlink{class_view_p_c_a33c96c61f61042319c66c19059836b7f}{ViewPC::ViewPC}(QWidget *parent) :
00005     QMainWindow(parent),
00006     ui(new \hyperlink{namespace_ui}{Ui}::\hyperlink{class_view_p_c}{ViewPC})
00007 \{
00008     ui->setupUi(\textcolor{keyword}{this});
00009 
00010     \hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed} = \textcolor{keyword}{true};
00011 
00012     \textcolor{comment}{// Alerts dictionary setup}
00013     QFile file(\textcolor{stringliteral}{":/config/ErrorsDict.json"});
00014     \textcolor{keywordflow}{if}(!file.open(QFile::ReadOnly | QFile::Text)) \{
00015         \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"Cannot open config file!"});
00016         \textcolor{keywordflow}{return};
00017     \}
00018     QByteArray readData = file.readAll();
00019     file.close();
00020 
00021     QJsonParseError error;
00022     QJsonDocument doc = QJsonDocument::fromJson(readData, &error);
00023     \hyperlink{class_view_p_c_a26f90436aca32e5bad46f5e69a7e7e09}{errorsDict} = doc.object();
00024     isEncrypt = \textcolor{keyword}{true};
00025 \}
\hypertarget{viewpc_8cpp_source.tex_l00029}{}\hyperlink{class_view_p_c_a91c51f5c1e6ed5ab12b410339f469b0f}{00029} \hyperlink{class_view_p_c_a91c51f5c1e6ed5ab12b410339f469b0f}{ViewPC::~ViewPC}()
00030 \{
00031     \textcolor{keyword}{delete} ui;
00032 \}
00033 
00034 \textcolor{keywordtype}{void} ViewPC::on\_encryptMode\_clicked()
00035 \{
00036     \textcolor{comment}{// Encrypt radio button clicked}
00037     \hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{setEncryptMode}(\textcolor{keyword}{true});
00038 \}
00039 
00040 \textcolor{keywordtype}{void} ViewPC::on\_decryptMode\_clicked()
00041 \{
00042     \textcolor{comment}{// Decrypt radio button clicked}
00043     \hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{setEncryptMode}(\textcolor{keyword}{false});
00044 \}
\hypertarget{viewpc_8cpp_source.tex_l00048}{}\hyperlink{class_view_p_c_a3b9b7a7be9702d8b160f257f1c74a776}{00048} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a3b9b7a7be9702d8b160f257f1c74a776}{ViewPC::on\_fileButton\_clicked}()
00049 \{
00050     \textcolor{comment}{// Opening QFileDialog depending on isEncrypt}
00051     \textcolor{keywordflow}{if}(isEncrypt)
00052         inputFileName = QFileDialog::getOpenFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Select file"}), \textcolor{stringliteral}{"/untitled.txt"}, tr(\textcolor{stringliteral}{"Text
       files (*.txt);;All Files (*)"}));
00053     \textcolor{keywordflow}{else}
00054         inputFileName = QFileDialog::getOpenFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Select file"}), \textcolor{stringliteral}{"/untitled.png"}, tr(\textcolor{stringliteral}{"PNG
       files (*.png);;All Files (*)"}));
00055     \textcolor{comment}{// Display the file name}
00056     ui->fileLabel->setText(inputFileName.isEmpty() ? \textcolor{stringliteral}{"File not chosen"} : inputFileName);
00057 \}
\hypertarget{viewpc_8cpp_source.tex_l00070}{}\hyperlink{class_view_p_c_a456d75b7c5d3a089302a576e7359f1f4}{00070} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a456d75b7c5d3a089302a576e7359f1f4}{ViewPC::on\_startButton\_clicked}()
00071 \{
00072     \textcolor{keywordflow}{if}(isEncrypt)
00073     \{
00074         \textcolor{comment}{// Getting the data}
00075         QString text = ui->text->toPlainText();
00076         QByteArray \hyperlink{namespace_errors_dict_setup_af570460846fb9f0c91abd308a095dcdc}{data};
00077         \textcolor{keywordflow}{if}(text.isEmpty()) \{
00078             \textcolor{keywordflow}{if}(inputFileName.isEmpty()) \{
00079                 \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"no\_input\_file"}, \textcolor{keyword}{true});
00080                 \textcolor{keywordflow}{return};
00081             \}
00082             \textcolor{comment}{// Opening the file}
00083             QFile file(inputFileName);
00084             \textcolor{keywordflow}{if} (!file.open(QIODevice::ReadOnly))
00085             \{
00086                 \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"open\_file\_fail"}, \textcolor{keyword}{true});
00087                 \textcolor{keywordflow}{return};
00088             \}
00089             \textcolor{comment}{// Check the data size}
00090             \textcolor{keyword}{auto} size = file.size();
00091             \textcolor{keywordflow}{if}(size > qPow(2, 24)) \{
00092                 \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"big\_file"}, \textcolor{keyword}{true});
00093                 file.close();
00094                 \textcolor{keywordflow}{return};
00095             \}
00096             data = file.readAll();
00097             file.close();
00098         \}
00099         \textcolor{keywordflow}{else}
00100             data = text.toUtf8();
00101         \textcolor{comment}{// Select image via EncryptDialog}
00102         \hyperlink{class_encrypt_dialog}{EncryptDialog} * \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog} = \textcolor{keyword}{new} \hyperlink{class_encrypt_dialog}{EncryptDialog}(data);
00103         dialog->exec();
00104         \textcolor{keywordflow}{if}(!dialog->\hyperlink{class_encrypt_dialog_ada4900bcd40894d9c098c65aa4066ac9}{success})
00105             \textcolor{keywordflow}{return};
00106 
00107         \textcolor{comment}{// Get the data}
00108         QByteArray encr\_data = dialog->\hyperlink{class_encrypt_dialog_a3e8998aa39696cbd1242f6420ef18143}{compr\_data};
00109 
00110         \textcolor{comment}{// Save the hash}
00111         QByteArray hash = QCryptographicHash::hash(data, QCryptographicHash::Sha256);
00112         encr\_data = hash + encr\_data;
00113 
00114         \textcolor{keywordflow}{switch} (selectedMode) \{
00115         \textcolor{keywordflow}{case} 1:
00116             emit \hyperlink{class_view_p_c_a652c98014c2df32178d43a5a9612dd99}{inject}(encr\_data, &dialog->\hyperlink{class_encrypt_dialog_a739a0df1d28d06b28a3fd16e2bc16c73}{image}, selectedMode, dialog->
      \hyperlink{class_encrypt_dialog_abf638fea37fbdbaba215954e2e239860}{bitsUsed});
00117             \textcolor{keywordflow}{break};
00118         \textcolor{keywordflow}{case} 2:
00119             emit \hyperlink{class_view_p_c_a9d179ff85ed8b1ca0ff7fa495965b52d}{encrypt}(data, &dialog->\hyperlink{class_encrypt_dialog_a739a0df1d28d06b28a3fd16e2bc16c73}{image}, selectedMode, dialog->
      \hyperlink{class_encrypt_dialog_a1afdef3c665fb0d0fae06d1df8e84951}{key});
00120             \textcolor{keywordflow}{break};
00121         \}
00122     \}
00123     \textcolor{keywordflow}{else}
00124     \{
00125         \textcolor{comment}{// Get the filename of the image}
00126         \textcolor{keywordflow}{if}(inputFileName.isEmpty()) \{
00127             \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"no\_file\_selected"}, \textcolor{keyword}{true});
00128             \textcolor{keywordflow}{return};
00129         \}
00130         QByteArray \hyperlink{namespace_errors_dict_setup_a09c268098d09ffb8e5504f30fa6d5dd9}{key} = \hyperlink{class_view_p_c_a559c95675ec98b15451f3bca47033d9c}{requestKey}().toUtf8();
00131         \textcolor{keywordflow}{if}(key.isEmpty())
00132             \textcolor{keywordflow}{return};
00133         QImage * res\_image = \textcolor{keyword}{new} QImage(inputFileName);
00134         emit \hyperlink{class_view_p_c_a365df051360d557c7221474ad856e0af}{decrypt}(res\_image, key, 0);
00135     \}
00136 \}
\hypertarget{viewpc_8cpp_source.tex_l00142}{}\hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{00142} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{ViewPC::alert}(QString message, \textcolor{keywordtype}{bool} isWarning)
00143 \{
00144     \textcolor{comment}{// Get message}
00145     \textcolor{keywordflow}{if}(\hyperlink{class_view_p_c_a26f90436aca32e5bad46f5e69a7e7e09}{errorsDict}.contains(message))
00146         message = \hyperlink{class_view_p_c_a26f90436aca32e5bad46f5e69a7e7e09}{errorsDict}[message].toString();
00147     \textcolor{comment}{// Create message box}
00148     QMessageBox box;
00149     \textcolor{keywordflow}{if}(isWarning)
00150         box.setIcon(QMessageBox::Warning);
00151     \textcolor{keywordflow}{else}
00152         box.setIcon(QMessageBox::Information);
00153     box.setText(message);
00154     box.setWindowIcon(QIcon(\textcolor{stringliteral}{":/icons/mail.png"}));
00155     box.setWindowTitle(\textcolor{stringliteral}{"Message"});
00156     box.exec();
00157 \}
\hypertarget{viewpc_8cpp_source.tex_l00163}{}\hyperlink{class_view_p_c_aaff156103970be7c777beedaf0020604}{00163} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_aaff156103970be7c777beedaf0020604}{ViewPC::saveData}(QByteArray Edata)
00164 \{
00165     \textcolor{comment}{// Save data using QFileDialog}
00166     QString outputFileName = QFileDialog::getSaveFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Save File"}),
00167                                \textcolor{stringliteral}{"/untitled.txt"},
00168                                tr(\textcolor{stringliteral}{"Text(*.txt);;All files (*)"}));
00169     QFile writeFile(outputFileName);
00170     \textcolor{keywordflow}{if} (!writeFile.open(QIODevice::WriteOnly))
00171     \{
00172         \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"save\_file\_fail"}, \textcolor{keyword}{true});
00173         \textcolor{keywordflow}{return};
00174     \}
00175     writeFile.write(Edata);
00176     writeFile.close();
00177     \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"decryption\_completed"});
00178 \}
\hypertarget{viewpc_8cpp_source.tex_l00184}{}\hyperlink{class_view_p_c_a7901ce10ffaaf2387bef1db7feea342d}{00184} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a7901ce10ffaaf2387bef1db7feea342d}{ViewPC::saveImage}(QImage * image)
00185 \{
00186     \textcolor{comment}{// Save image using QFileDialog}
00187     QString outputFileName = QFileDialog::getSaveFileName(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Save Image"}),
00188                                \textcolor{stringliteral}{"/untitled.png"},
00189                                tr(\textcolor{stringliteral}{"Images(*.png)"}));
00190     \textcolor{keywordflow}{if}(!image->save(outputFileName)) \{
00191         \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"save\_file\_fail"}, \textcolor{keyword}{true});
00192         \textcolor{keywordflow}{return};
00193     \}
00194     \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"encryption\_completed"});
00195 \}
\hypertarget{viewpc_8cpp_source.tex_l00202}{}\hyperlink{class_view_p_c_a9c32a1fdb6ead84e5ada8fba8860c7ed}{00202} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a9c32a1fdb6ead84e5ada8fba8860c7ed}{ViewPC::setProgress}(\textcolor{keywordtype}{int} val)
00203 \{
00204     \textcolor{keywordflow}{if}(val < 0) \{
00205         \textcolor{comment}{// Create dialog}
00206         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog} = \textcolor{keyword}{new} QProgressDialog(\textcolor{stringliteral}{"Cryption in progress."}, \textcolor{stringliteral}{"Cancel"}, 0, 100);
00207         connect(\hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}, SIGNAL(canceled()), \textcolor{keyword}{this}, SLOT(\hyperlink{class_view_p_c_ad7ba2fcf1d17862de15e32432823f7b0}{abortCircuit}()));
00208         \hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed} = \textcolor{keyword}{false};
00209         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->setWindowTitle(\textcolor{stringliteral}{"Processing"});
00210         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->setWindowIcon(QIcon(\textcolor{stringliteral}{":/icons/loading.png"}));
00211         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->show();
00212     \}
00213     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(val > 100 && !\hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed}) \{
00214         \textcolor{comment}{// Close dialog}
00215         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->setValue(100);
00216         QThread::msleep(25);
00217         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->close();
00218         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->reset();
00219         \hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed} = \textcolor{keyword}{true};
00220     \}
00221     \textcolor{comment}{// Update the progress}
00222     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!\hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed})
00223         \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->setValue(val);
00224 \}
\hypertarget{viewpc_8cpp_source.tex_l00228}{}\hyperlink{class_view_p_c_ad7ba2fcf1d17862de15e32432823f7b0}{00228} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_ad7ba2fcf1d17862de15e32432823f7b0}{ViewPC::abortCircuit}()
00229 \{
00230     \textcolor{comment}{// Set the flag}
00231     \hyperlink{class_view_p_c_add8c82aa2b0b934212aa5bde9277ab36}{progressDialogClosed} = \textcolor{keyword}{true};
00232     \textcolor{comment}{// Close the dialog}
00233     \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->close();
00234     \hyperlink{class_view_p_c_a31abbb470fe329b44e6ffee202b903ca}{dialog}->reset();
00235     emit \hyperlink{class_view_p_c_aa652102ce6b5757b8eef830409c8cabf}{abortModel}();
00236 \}
\hypertarget{viewpc_8cpp_source.tex_l00241}{}\hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{00241} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a5b48951efefdc0e3039c9a4bf185320b}{ViewPC::setEncryptMode}(\textcolor{keywordtype}{bool} encr)
00242 \{
00243     ui->text->setText(\textcolor{stringliteral}{""});
00244     ui->text->setEnabled(encr);
00245     isEncrypt = encr;
00246     ui->startButton->setText(encr ? \textcolor{stringliteral}{"Continue configuration"} : \textcolor{stringliteral}{"Start decryption"});
00247     ui->enLabel1->setText(encr ? \textcolor{stringliteral}{"Type in the text for encryption:"} : \textcolor{stringliteral}{"Text input isn't supported in
       decryption mode"});
00248     ui->enLabel1->setEnabled(encr);
00249     ui->enLabel2->setText(encr ? \textcolor{stringliteral}{"Or use the file dialog to choose a file:"} : \textcolor{stringliteral}{"Choose a file for
       decryption:"});
00250     ui->comboBox->setEnabled(encr);
00251 \}
\hypertarget{viewpc_8cpp_source.tex_l00256}{}\hyperlink{class_view_p_c_ac05220df875b7c4f24405a5742476ebf}{00256} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_ac05220df875b7c4f24405a5742476ebf}{ViewPC::setVersion}(QString version)
00257 \{
00258     \textcolor{comment}{// Version setup}
00259     versionString = version;
00260 \}
\hypertarget{viewpc_8cpp_source.tex_l00265}{}\hyperlink{class_view_p_c_a559c95675ec98b15451f3bca47033d9c}{00265} QString \hyperlink{class_view_p_c_a559c95675ec98b15451f3bca47033d9c}{ViewPC::requestKey}()
00266 \{
00267     \textcolor{keywordtype}{bool} ok;
00268     QString text = QInputDialog::getText(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"QInputDialog::getText()"}),
00269                                          tr(\textcolor{stringliteral}{"Enter the keyphrase:"}), QLineEdit::Normal,
00270                                          QDir::home().dirName(), &ok);
00271     \textcolor{keywordflow}{if}(text.isEmpty() && ok) \{
00272         \hyperlink{class_view_p_c_a7c467169467789561078abc9d4fe57bd}{alert}(\textcolor{stringliteral}{"no\_key"}, \textcolor{keyword}{true});
00273         \textcolor{keywordflow}{return} QString();
00274     \}
00275     \textcolor{keywordflow}{return} ok ? text : QString();
00276 \}
00277 
00278 QByteArray ViewPC::bytes(\textcolor{keywordtype}{long} \textcolor{keywordtype}{long} n)
00279 \{
00280     \textcolor{keywordflow}{return} QByteArray::fromHex(QByteArray::number(n, 16));
00281 \}
\hypertarget{viewpc_8cpp_source.tex_l00285}{}\hyperlink{class_view_p_c_a09a46da4d492eb3dde88f35dc58c997b}{00285} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a09a46da4d492eb3dde88f35dc58c997b}{ViewPC::on\_actionAbout\_triggered}()
00286 \{
00287     \hyperlink{class_about_p_c}{AboutPC} about;
00288     about.\hyperlink{class_about_p_c_aa3815d4826d0c8d87122449537a0a4d5}{setVersion}(versionString);
00289     about.exec();
00290 \}
00291 
\hypertarget{viewpc_8cpp_source.tex_l00295}{}\hyperlink{class_view_p_c_a0d252ff4829260c6c76769fbd24b7cd7}{00295} \textcolor{keywordtype}{void} \hyperlink{class_view_p_c_a0d252ff4829260c6c76769fbd24b7cd7}{ViewPC::on\_actionHelp\_triggered}()
00296 \{
00297     QUrl docLink(\textcolor{stringliteral}{"https://alexkovrigin.me/PictureCrypt"});
00298     QDesktopServices::openUrl(docLink);
00299 \}
00300 
00301 \textcolor{keywordtype}{void} ViewPC::on\_actionJPHS\_path\_triggered()
00302 \{
00303     QString dir = QFileDialog::getExistingDirectory(\textcolor{keyword}{this}, tr(\textcolor{stringliteral}{"Open JPHS folder"}),
00304                                                     \textcolor{stringliteral}{"/home"},
00305                                                     QFileDialog::ShowDirsOnly
00306                                                     | QFileDialog::DontResolveSymlinks);
00307     emit \hyperlink{class_view_p_c_ae81085836c0c01bc9556a5b27eb8d19c}{setJPHSDir}(dir);
00308 \}
00309 
00310 \textcolor{keywordtype}{void} ViewPC::on\_comboBox\_currentIndexChanged(\textcolor{keywordtype}{int} index)
00311 \{
00312     selectedMode = index + 1;
00313 \}
00314 
00315 \textcolor{keywordtype}{void} ViewPC::on\_text\_textChanged()
00316 \{
00317     ui->fileButton->setEnabled(ui->text->toPlainText().isEmpty());
00318 \}
\end{DoxyCode}
